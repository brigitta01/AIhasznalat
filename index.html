<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI használat</title>

  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:Poppins,system-ui,Arial;}
    body{
      min-height:100vh;
      background: linear-gradient(135deg,#a8d8ff,#64b5f6);
      display:flex;justify-content:center;padding:22px;
    }
    .wrap{width:100%;max-width:1050px;}
    .hero{
      background:#fff;border-radius:22px;
      box-shadow:0 10px 25px rgba(0,0,0,.15);
      padding:26px;margin-bottom:14px;
    }
    .hero h1{color:#1e88e5;font-size:2rem;margin-bottom:8px;}
    .lead{color:#556;line-height:1.4;margin-bottom:12px;}

    .controls{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
      margin: 0 0 10px 0;
    }
    .controls label{font-weight:800;color:#2b3350;font-size:.92rem;}
    select{
      border:1px solid #d7e6ff;background:#f7fbff;color:#2b3350;
      padding:10px 12px;border-radius:12px;font-weight:700;cursor:pointer;
    }

    .kpis{
      display:grid;grid-template-columns:repeat(3,1fr);
      gap:12px;margin-top:12px;
    }
    .kpi{
      background:#f7fbff;border:1px solid #d7e6ff;border-radius:16px;padding:12px;
    }
    .kpi .num{color:#1e88e5;font-weight:900;font-size:1.2rem;}
    .kpi .lab{color:#556;margin-top:6px;font-size:.9rem;}

    .card{
      background:#fff;border-radius:22px;
      box-shadow:0 10px 25px rgba(0,0,0,.12);
      padding:18px;
      margin-bottom: 14px;
    }
    .card h2{color:#2b3350;font-size:1.05rem;margin-bottom:6px;}
    .desc{color:#556;line-height:1.35;margin:0 0 10px 0;font-size:.93rem;}
    .chart{width:100%;}
    @media (max-width: 980px){
      .kpis{grid-template-columns:1fr;}
    }
  </style>

  <!-- Vega/Vega-Lite -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>

<body>
  <main class="wrap">
    <header class="hero">
      <h1>AI használat</h1>
      <p class="lead">Korosztály, gyakoriság, helyszín, célok, térkép.</p>

      <div class="controls">
        <label for="ageGlobal">Korosztály:</label>
        <select id="ageGlobal">
          <option value="ALL">Összes</option>
          <option value="13–17">13–17</option>
          <option value="18–20">18–20</option>
          <option value="21–24">21–24</option>
          <option value="25–34">25–34</option>
          <option value="35–44">35–44</option>
          <option value="45–54">45–54</option>
          <option value="55+">55+</option>
        </select>
      </div>

      <div class="kpis">
        <div class="kpi">
          <div class="num" id="kpiN">—</div>
          <div class="lab">Mintanagyság</div>
        </div>
        <div class="kpi">
          <div class="num" id="kpiUsePct">—</div>
          <div class="lab">AI-használók aránya</div>
        </div>
        <div class="kpi">
          <div class="num" id="kpiTopPurpose">—</div>
          <div class="lab">Top felhasználási cél</div>
        </div>
      </div>
    </header>

    <section class="card">
      <h2>1) AI használata korosztály szerint</h2>
      <p class="desc">Az ábra megmutatja, hogy az egyes korosztályokban mekkora az AI-t használók aránya.</p>
      <div id="vis1" class="chart"></div>
    </section>

    <section class="card">
      <h2>2) Használati gyakoriság korosztály szerint</h2>
      <p class="desc">A vizualizáció azt mutatja, hogy az AI-használók milyen gyakran használják az eszközöket.</p>
      <div class="controls">
        <label for="freq2">Gyakoriság:</label>
        <select id="freq2">
          <option value="ALL">Összes</option>
          <option value="Napi">Napi</option>
          <option value="Heti többször">Heti többször</option>
          <option value="Heti 1x">Heti 1x</option>
          <option value="Ritkán">Ritkán</option>
        </select>
      </div>
      <div id="vis2" class="chart"></div>
    </section>

    <section class="card">
      <h2>3) Hol használják a legtöbbet?</h2>
      <p class="desc">Az ábra bemutatja, hogy a felhasználók milyen környezetben használják leginkább az AI-t.</p>
      <div class="controls">
        <label for="freq3">Gyakoriság:</label>
        <select id="freq3">
          <option value="ALL">Összes</option>
          <option value="Napi">Napi</option>
          <option value="Heti többször">Heti többször</option>
          <option value="Heti 1x">Heti 1x</option>
          <option value="Ritkán">Ritkán</option>
        </select>
      </div>
      <div id="vis3" class="chart"></div>
    </section>

    <section class="card">
      <h2>4) Térkép</h2>
      <p class="desc">A térkép országonként mutatja az AI-használók arányát.</p>
      <div id="vis4" class="chart"></div>
    </section>

    <section class="card">
      <h2>5) Mire használják?</h2>
      <p class="desc">A diagram megmutatja, hogy az AI-t leggyakrabban milyen célokra használják.</p>
      <div class="controls">
        <label for="place5">Helyszín:</label>
        <select id="place5">
          <option value="ALL">Összes</option>
        </select>
      </div>
      <div id="vis5" class="chart"></div>
    </section>

    <section class="card">
      <h2>6) Heatmap</h2>
      <p class="desc">A hőtérkép a felhasználási célok és a helyszínek kapcsolatát mutatja.</p>
      <div id="vis6" class="chart"></div>
    </section>

  </main>

<script>
/* ====== TIDY adat (1200 sor) ====== */
const AGE = ["13–17","18–20","21–24","25–34","35–44","45–54","55+"];
const PLACE = ["Otthon","Iskola/Egyetem","Munkahely","Mobil útközben","Közterület"];
const PURPOSE = ["Csevegés/infó","Tanulás","Kódolás","Képgenerálás","Keresés/összegzés","Ötletelés/írás"];
const FREQ = ["Napi","Heti többször","Heti 1x","Ritkán"];

/* országnevek: egyezzenek a data/countries.json "name" mezőivel */
const COUNTRIES = [
  "Hungary","Romania","Germany","France","United Kingdom","Italy","Spain","Netherlands",
  "Poland","Czech Republic","Austria","Sweden","Norway","Denmark","Portugal","Greece",
  "Ireland","Belgium","Switzerland","Finland","Bulgaria","Croatia","Serbia","Slovakia"
];

function pickWeighted(items, weights){
  const s = weights.reduce((a,b)=>a+b,0);
  let r = Math.random()*s;
  for (let i=0;i<items.length;i++){
    r -= weights[i];
    if (r<=0) return items[i];
  }
  return items[items.length-1];
}

function genRow(id){
  const age = pickWeighted(AGE, [7,10,16,28,18,12,9]);

  const pUse = (age==="13–17")?0.60 :
               (age==="18–20")?0.75 :
               (age==="21–24")?0.84 :
               (age==="25–34")?0.82 :
               (age==="35–44")?0.70 :
               (age==="45–54")?0.55 : 0.40;

  const uses_ai = (Math.random() < pUse) ? "Igen" : "Nem";

  const country = pickWeighted(COUNTRIES, [
    4,4,5,5,5,5,4,4,
    4,4,3,3,2,2,3,3,
    3,3,2,2,3,2,2,3
  ]);

  if (uses_ai === "Nem"){
    return {id, age_group: age, uses_ai, frequency:"N/A", place:"N/A", purpose:"N/A", country};
  }

  const frequency = pickWeighted(FREQ, [34,30,18,18]);
  const place = pickWeighted(PLACE, [44,18,24,10,4]);
  const purpose = pickWeighted(PURPOSE, [30,26,14,10,14,6]);

  return {id, age_group: age, uses_ai, frequency, place, purpose, country};
}

const DATA = Array.from({length:1200}, (_,i)=>genRow(i+1));

/* ====== helpers ====== */
function getAge(){ return document.getElementById("ageGlobal").value; }

function rowsAllWithAge(){
  const age = getAge();
  return (age==="ALL") ? DATA : DATA.filter(d=>d.age_group===age);
}
function rowsYesWithAge(){
  return rowsAllWithAge().filter(d=>d.uses_ai==="Igen");
}

function updateKPIs(){
  const all = rowsAllWithAge();
  const yes = all.filter(d=>d.uses_ai==="Igen");
  const usePct = all.length ? (yes.length/all.length*100) : 0;

  const m = new Map();
  for (const r of yes){
    if (r.purpose==="N/A") continue;
    m.set(r.purpose, (m.get(r.purpose)||0)+1);
  }
  let best = ["—",0];
  for (const [k,v] of m.entries()){
    if (v>best[1]) best=[k,v];
  }

  document.getElementById("kpiN").textContent = all.length.toLocaleString("hu-HU");
  document.getElementById("kpiUsePct").textContent = `${usePct.toFixed(1)}%`;
  document.getElementById("kpiTopPurpose").textContent = best[0]==="—" ? "—" : `${best[0]} (${best[1]})`;
}

function percentByCategory(rowsYes, key){
  const total = rowsYes.length || 1;
  const counts = new Map();
  for (const r of rowsYes){
    const k = r[key];
    counts.set(k, (counts.get(k)||0)+1);
  }
  const out = [];
  for (const [k,v] of counts.entries()){
    if (k==="N/A") continue;
    out.push({category:k, pct:(v/total*100), count:v});
  }
  return out;
}

function buildAgeUsePct(rowsAll){
  const out = [];
  for (const a of AGE){
    const r = rowsAll.filter(d=>d.age_group===a);
    const total = r.length;
    const yes = r.filter(d=>d.uses_ai==="Igen").length;
    out.push({category:a, value: total ? (yes/total*100) : 0, count: total});
  }
  return out;
}

function countryUsePct(rowsAll){
  const out = [];
  for (const c of COUNTRIES){
    const r = rowsAll.filter(d=>d.country===c);
    const total = r.length;
    const yes = r.filter(d=>d.uses_ai==="Igen").length;
    if (total>0) out.push({country:c, total, yes, value: yes/total*100});
  }
  return out;
}

/* ====== Vega-Lite specs ====== */
function baseConfig(){
  return {
    "config": {
      "axis": {"labelColor":"#2b3350","titleColor":"#2b3350"},
      "view": {"stroke": null}
    }
  };
}

function barPctSpec(values, title, xTitle, yTitle){
  return {
    ...baseConfig(),
    "width":"container",
    "height":260,
    "data":{"values": values},
    "mark":{"type":"bar","cornerRadiusTopLeft":6,"cornerRadiusTopRight":6},
    "encoding":{
      "x":{"field":"category","type":"nominal","title": xTitle},
      "y":{"field":"value","type":"quantitative","title": yTitle},
      "tooltip":[
        {"field":"category","type":"nominal","title": xTitle},
        {"field":"value","type":"quantitative","title": yTitle, "format": ".1f"},
        {"field":"count","type":"quantitative","title":"Db"}
      ]
    },
    "title":{"text": title, "color":"#1e88e5", "fontSize":14, "fontWeight":800}
  };
}

function stackedSpec(rowsYes, title){
  return {
    ...baseConfig(),
    "width":"container",
    "height":260,
    "data":{"values": rowsYes},
    "mark":"bar",
    "encoding":{
      "x":{"field":"age_group","type":"nominal","title":"Korosztály","sort":AGE},
      "y":{"aggregate":"count","type":"quantitative","title":"Válaszok (db)"},
      "color":{"field":"frequency","type":"nominal","title":"Gyakoriság","sort":FREQ},
      "tooltip":[
        {"field":"age_group","type":"nominal","title":"Korosztály"},
        {"field":"frequency","type":"nominal","title":"Gyakoriság"},
        {"aggregate":"count","type":"quantitative","title":"Db"}
      ]
    },
    "title":{"text": title, "color":"#1e88e5", "fontSize":14, "fontWeight":800}
  };
}

function barCountByAgeSpec(rowsYes, freq, title){
  return {
    ...baseConfig(),
    "width":"container",
    "height":260,
    "data":{"values": rowsYes.filter(d=>d.frequency===freq)},
    "mark":{"type":"bar","cornerRadiusTopLeft":6,"cornerRadiusTopRight":6},
    "encoding":{
      "x":{"field":"age_group","type":"nominal","title":"Korosztály","sort":AGE},
      "y":{"aggregate":"count","type":"quantitative","title":"Válaszok (db)"},
      "tooltip":[
        {"field":"age_group","type":"nominal","title":"Korosztály"},
        {"aggregate":"count","type":"quantitative","title":"Db"}
      ]
    },
    "title":{"text": title, "color":"#1e88e5", "fontSize":14, "fontWeight":800}
  };
}

/* ====== 4) TÉRKÉP – helyi fájlokból ====== */
function mapSpec(countryValues){
  return {
    ...baseConfig(),
    "width":"container",
    "height":380,
    "projection":{"type":"equalEarth"},
    "data":{
      "url":"world-110m.json",
      "format":{"type":"topojson","feature":"countries"}
    },
    "transform":[
      {
        "lookup":"id",
        "from":{
          "data":{"url":"ountries.json"},
          "key":"id",
          "fields":["name"]
        }
      },
      {
        "lookup":"name",
        "from":{
          "data":{"values": countryValues},
          "key":"country",
          "fields":["value","total","yes"]
        }
      },
      {"filter":"isValid(datum.name)"}  // csak azonosított országok
    ],
    "mark":{"type":"geoshape","stroke":"#ffffff"},
    "encoding":{
      "color":{
        "condition":{
          "test":"isValid(datum.value)",
          "field":"value",
          "type":"quantitative",
          "title":"AI-használók aránya (%)",
          "scale":{"zero":false}
        },
        "value":"#e9f2ff"
      },
      "tooltip":[
        {"field":"name","type":"nominal","title":"Ország"},
        {"field":"value","type":"quantitative","title":"AI-használók aránya (%)","format":".1f"},
        {"field":"yes","type":"quantitative","title":"AI-használók (db)"},
        {"field":"total","type":"quantitative","title":"Összes (db)"}
      ]
    }
  };
}

function heatmapSpec(rowsYes){
  return {
    ...baseConfig(),
    "width":"container",
    "height":340,
    "data":{"values": rowsYes.filter(d=>d.place!=="N/A" && d.purpose!=="N/A")},
    "mark":"rect",
    "encoding":{
      "x":{"field":"place","type":"nominal","title":"Helyszín","sort":PLACE},
      "y":{"field":"purpose","type":"nominal","title":"Cél","sort":PURPOSE},
      "color":{"aggregate":"count","type":"quantitative","title":"Intenzitás (db)"},
      "tooltip":[
        {"field":"place","type":"nominal","title":"Helyszín"},
        {"field":"purpose","type":"nominal","title":"Cél"},
        {"aggregate":"count","type":"quantitative","title":"Db"}
      ]
    }
  };
}

/* ====== render ====== */
function fillPlaceDropdown(){
  const sel = document.getElementById("place5");
  if (sel.options.length > 1) return;
  for (const p of PLACE){
    const opt = document.createElement("option");
    opt.value = p;
    opt.textContent = p;
    sel.appendChild(opt);
  }
}

async function renderAll(){
  fillPlaceDropdown();
  updateKPIs();

  const all = rowsAllWithAge();
  const yes = rowsYesWithAge();

  // 1
  const v1 = buildAgeUsePct(all);
  await vegaEmbed("#vis1", barPctSpec(v1, "AI-használók aránya korosztály szerint (%)", "Korosztály", "Arány (%)"), {actions:false});

  // 2
  const f2 = document.getElementById("freq2").value;
  if (f2 === "ALL"){
    await vegaEmbed("#vis2", stackedSpec(yes, "Gyakoriság korosztály szerint (db)"), {actions:false});
  } else {
    await vegaEmbed("#vis2", barCountByAgeSpec(yes, f2, `Gyakoriság (${f2}) korosztály szerint (db)`), {actions:false});
  }

  // 3
  const f3 = document.getElementById("freq3").value;
  const yes3 = (f3==="ALL") ? yes : yes.filter(d=>d.frequency===f3);
  const v3 = percentByCategory(yes3, "place")
    .map(d=>({category:d.category, value:d.pct, count:d.count}))
    .sort((a,b)=>PLACE.indexOf(a.category)-PLACE.indexOf(b.category));
  await vegaEmbed("#vis3", barPctSpec(v3, "Hol használják a legtöbbet? (%)", "Helyszín", "Arány (%)"), {actions:false});

  // 4
  const mapValues = countryUsePct(all);
  await vegaEmbed("#vis4", mapSpec(mapValues), {actions:false});

  // 5
  const placePick = document.getElementById("place5").value;
  const yes5 = (placePick==="ALL") ? yes : yes.filter(d=>d.place===placePick);
  const v5 = percentByCategory(yes5, "purpose")
    .map(d=>({category:d.category, value:d.pct, count:d.count}))
    .sort((a,b)=>b.value-a.value);
  await vegaEmbed("#vis5", barPctSpec(v5, "Mire használják? (%)", "Felhasználási cél", "Arány (%)"), {actions:false});

  // 6
  await vegaEmbed("#vis6", heatmapSpec(yes), {actions:false});
}

document.getElementById("ageGlobal").addEventListener("change", renderAll);
document.getElementById("freq2").addEventListener("change", renderAll);
document.getElementById("freq3").addEventListener("change", renderAll);
document.getElementById("place5").addEventListener("change", renderAll);

let t;
window.addEventListener("resize", () => {
  clearTimeout(t);
  t = setTimeout(renderAll, 150);
});

renderAll();
</script>
</body>
</html>
